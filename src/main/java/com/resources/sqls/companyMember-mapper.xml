<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mapper.CompanyMemberMapper">
    <select id="checkUserMemberOfCompany" resultType="_boolean">
        select EXISTS(select * from CompanyMember WHERE userNo = #{userNo} AND companyNo = #{companyNo})
    </select>
    <insert id="requestCompanyJoin">
        insert into CompanyMember(userNo, companyNo, role, editAuth, readAuth, requestDate, createDate, reviseDate)
        VALUES (#{userNo}, #{companyNo}, 'PRE_MEMBER', false, false, now(), now(), now())
    </insert>
    <select id="checkUserReadAuth" resultType="_boolean">
        select readAuth
        from CompanyMember
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </select>
    <select id="checkUserEditAuth" resultType="_boolean">
        select editAuth
        from CompanyMember
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </select>
    <update id="updateUserReadAuth">
        update CompanyMember
        SET readAuth = !readAuth
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </update>
    <update id="updateUserEditAuth">
        update CompanyMember
        SET editAuth = !editAuth
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </update>
    <select id="getUserRoleOfCompany" resultType="CompanyRole">
        select role
        from CompanyMember
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </select>
    <delete id="deleteUserMember">
        delete
        from CompanyMember
        WHERE userNo = #{userNo}
          AND companyNo = #{companyNo}
    </delete>
    <select id="checkUserHasCompany" resultType="_boolean">
        select EXISTS(select * from CompanyMember WHERE userNo = #{userNo})
    </select>
    <select id="getUserCompany" resultType="Company">
        select *
        from Company
        WHERE no = (select companyNo from CompanyMember WHERE userNo = #{userNo})
    </select>
    <insert id="registerCompanyMaster">
        insert into CompanyMember(userNo, companyNo, role, editAuth, readAuth, requestDate, createDate, reviseDate)
        VALUES (#{userNo}, #{companyNo}, 'MASTER', true, true, now(), now(), now())
    </insert>
</mapper>